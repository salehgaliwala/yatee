jQuery((function(t){var a={init:function(){t("#wcmp-order-details").on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wcmp-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("click","#order_status a",this.order_status_changed).on("keyup change",".split-input :input",(function(){var a=t(this).parent().prev().find(":input");a&&(""===a.val()||a.is(".match-total"))&&a.val(t(this).val()).addClass("match-total")})).on("keyup",".split-input :input",(function(){t(this).removeClass("match-total")}))},block:function(){t("#wcmp-order-details").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#wcmp-order-details").unblock()},quantity_changed:function(){var a=t(this).closest("tr.item"),e=t(this).val(),r=t(this).attr("data-qty"),i=t("input.line_total",a),n=t("input.line_subtotal",a),o=accounting.unformat(i.attr("data-total"),wcmp_order_details_js_script_data.mon_decimal_point)/r;i.val(parseFloat(accounting.formatNumber(o*e,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point));var _=accounting.unformat(n.attr("data-subtotal"),wcmp_order_details_js_script_data.mon_decimal_point)/r;n.val(parseFloat(accounting.formatNumber(_*e,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point)),t("input.line_tax",a).each((function(){var i=t(this),n=i.data("tax_id"),o=accounting.unformat(i.attr("data-total_tax"),wcmp_order_details_js_script_data.mon_decimal_point)/r,_=t('input.line_subtotal_tax[data-tax_id="'+n+'"]',a),d=accounting.unformat(_.attr("data-subtotal_tax"),wcmp_order_details_js_script_data.mon_decimal_point)/r;0<o&&i.val(parseFloat(accounting.formatNumber(o*e,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point)),0<d&&_.val(parseFloat(accounting.formatNumber(d*e,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point))})),t(this).trigger("quantity_changed")},order_status_changed:function(){var a=t(this).data("status"),e=t("#order_current_status").val(),r=t("#order_ID").val();if(t(this).parents(".change-status").find(".order-status-text").removeClass((function(t,a){return(a.match(/(^|\s)wc\S+/g)||[]).join(" ")})).addClass(a),e==a)return t(".change-status").removeClass("loaderOverlay"),t(".dropdown-order-statuses").removeClass("open"),!1;if("wc-cancelled"==a){if(!window.confirm(wcmp_order_details_js_script_data.i18n_do_cancel))return!1}else if("wc-cancelled"==e)return!1;t(".change-status").addClass("loaderOverlay");var i={action:"wcmp_order_status_changed",order_id:r,selected_status:a,security:wcmp_order_details_js_script_data.grant_access_nonce};t.post(wcmp_order_details_js_script_data.ajax_url,i,(function(a){a&&(t(".order_status_lbl").html(""),"wc-cancelled"==a.status_key&&t(".dropdown-order-statuses").hide(),t(".order_status_lbl").html(a.status_name),t("#order_current_status").val(a.status_key),t(".change-status").removeClass("loaderOverlay"))}))},refund_items:function(){return t("div.wcmp-order-refund-items").slideDown(),t("div.wcmp-order-data-row-toggle").not("div.wcmp-order-refund-items").slideUp(),t("div.wcmp-order-totals-items").slideUp(),t("#wcmp-order-details").find("div.refund").show(),!1},cancel:function(){return t("div.wcmp-order-data-row-toggle").not("div.wcmp-order-actions").slideUp(),t("div.wcmp-order-actions").slideDown(),t("div.wcmp-order-totals-items").slideDown(),t("#wcmp-order-details").find("div.refund").hide(),!1},refunds:{do_refund:function(){if(a.block(),window.confirm(wcmp_order_details_js_script_data.i18n_do_refund)){var e=t("input#refund_amount").val(),r=t("input#refund_reason").val(),i=t("input#refunded_amount").val(),n={},o={},_={};t(".refund input.refund_order_item_qty").each((function(a,e){t(e).closest("tr").data("order_item_id")&&e.value&&(n[t(e).closest("tr").data("order_item_id")]=e.value)})),t(".refund input.refund_line_total").each((function(a,e){t(e).closest("tr").data("order_item_id")&&(o[t(e).closest("tr").data("order_item_id")]=accounting.unformat(e.value,wcmp_order_details_js_script_data.mon_decimal_point))})),t(".refund input.refund_line_tax").each((function(a,e){if(t(e).closest("tr").data("order_item_id")){var r=t(e).data("tax_id");_[t(e).closest("tr").data("order_item_id")]||(_[t(e).closest("tr").data("order_item_id")]={}),_[t(e).closest("tr").data("order_item_id")][r]=accounting.unformat(e.value,wcmp_order_details_js_script_data.mon_decimal_point)}}));var d={action:"wcmp_do_refund",order_id:wcmp_order_details_js_script_data.post_id,refund_amount:e,refunded_amount:i,refund_reason:r,line_item_qtys:JSON.stringify(n,null,""),line_item_totals:JSON.stringify(o,null,""),line_item_tax_totals:JSON.stringify(_,null,""),api_refund:t(this).is(".do-api-refund"),restock_refunded_items:t("#restock_refunded_items:checked").length?"true":"false",security:wcmp_order_details_js_script_data.order_item_nonce};t.post(wcmp_order_details_js_script_data.ajax_url,d,(function(t){!0===t.success?window.location.href=window.location.href:(window.alert(t.data.error),window.location.href=window.location.href,a.unblock())}))}else a.unblock()},input_changed:function(){var a=0;t(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping").each((function(){t(this).find(".refund input:not(.refund_order_item_qty)").each((function(e,r){a+=parseFloat(accounting.unformat(t(r).val()||0,wcmp_order_details_js_script_data.mon_decimal_point))}))})),t("#refund_amount").val(accounting.formatNumber(a,wcmp_order_details_js_script_data.currency_format_num_decimals,"",wcmp_order_details_js_script_data.mon_decimal_point)).change()},amount_changed:function(){var a=accounting.unformat(t(this).val(),wcmp_order_details_js_script_data.mon_decimal_point);t("button .wc-order-refund-amount .amount").text(accounting.formatMoney(a,{symbol:wcmp_order_details_js_script_data.currency_format_symbol,decimal:wcmp_order_details_js_script_data.currency_format_decimal_sep,thousand:wcmp_order_details_js_script_data.currency_format_thousand_sep,precision:wcmp_order_details_js_script_data.currency_format_num_decimals,format:wcmp_order_details_js_script_data.currency_format}))},refund_quantity_changed:function(){var a=t(this).closest("tr.item"),e=a.find("input.quantity").val(),r=t(this).val(),i=t("input.line_total",a),n=t("input.refund_line_total",a),o=accounting.unformat(i.attr("data-total"),wcmp_order_details_js_script_data.mon_decimal_point)/e;n.val(parseFloat(accounting.formatNumber(o*r,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point)).change(),t(".refund_line_tax",a).each((function(){var i=t(this),n=i.data("tax_id"),o=t('input.line_tax[data-tax_id="'+n+'"]',a),_=accounting.unformat(o.data("total_tax"),wcmp_order_details_js_script_data.mon_decimal_point)/e;0<_?i.val(parseFloat(accounting.formatNumber(_*r,wcmp_order_details_js_script_data.rounding_precision,"")).toString().replace(".",wcmp_order_details_js_script_data.mon_decimal_point)).change():i.val(0).change()})),r>0?t("#restock_refunded_items").closest("tr").show():(t("#restock_refunded_items").closest("tr").hide(),t(".woocommerce_order_items input.refund_order_item_qty").each((function(){t(this).val()>0&&t("#restock_refunded_items").closest("tr").show()}))),t(this).trigger("refund_quantity_changed")}}},e={init:function(){t(".date-picker").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),t(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access).on("click","#copy-download-link",this.copy_link).on("aftercopy","#copy-download-link",this.copy_success).on("aftercopyfailure","#copy-download-link",this.copy_fail)},grant_access:function(){var a=t("#grant_access_id").val();if(a){t(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={action:"wcmp_grant_access_to_download",product_ids:a,loop:t(".order_download_permissions .wc-metabox").length,order_id:wcmp_order_details_js_script_data.post_id,security:wcmp_order_details_js_script_data.grant_access_nonce};return t.post(wcmp_order_details_js_script_data.ajax_url,e,(function(a){a?t(".order_download_permissions .wc-metaboxes").append(a):window.alert(wcmp_order_details_js_script_data.i18n_download_permission_fail),t(document.body).trigger("wc-init-datepickers"),t("#grant_access_id").val("").change(),t(".order_download_permissions").unblock()})),!1}},revoke_access:function(){if(window.confirm(wcmp_order_details_js_script_data.i18n_permission_revoke)){var a=t(this).parent().parent(),e=t(this).attr("rel").split(",")[0],r=t(this).attr("rel").split(",")[1],i=t(this).data("permission_id");if(e>0){t(a).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={action:"woocommerce_revoke_access_to_download",product_id:e,download_id:r,permission_id:i,order_id:wcmp_order_details_js_script_data.post_id,security:wcmp_order_details_js_script_data.revoke_access_nonce};t.post(wcmp_order_details_js_script_data.ajax_url,n,(function(){t(a).fadeOut("300",(function(){t(a).remove()}))}))}else t(a).fadeOut("300",(function(){t(a).remove()}))}return!1},copy_link:function(a){wcClearClipboard(),wcSetClipboard(t(this).attr("href"),t(this)),a.preventDefault()},copy_success:function(){t(this).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()},copy_fail:function(){t(this).tipTip({attribute:"data-tip-failed",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()}};a.init(),e.init()}));